
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.18">
    
    
      
        <title>🔸 Bare-Metal ARM Cortex Target Bring-Up - libhal</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#bare-metal-arm-cortex-target-bring-up" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../../..">
    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="libhal" class="md-header__button md-logo" aria-label="libhal" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            libhal
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              🔸 Bare-Metal ARM Cortex Target Bring-Up
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_3" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_3">
            
              <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/libhal/libhal/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    libhal
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="libhal" class="md-nav__button md-logo" aria-label="libhal" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    libhal
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/libhal/libhal/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    libhal
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        🏡 Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/" class="md-nav__link">
        🚀 Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          📖 User Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          📖 User Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/terms/" class="md-nav__link">
        📃 Learning the Terms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/interfaces/" class="md-nav__link">
        🔗 Interfaces & APIs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/configuration/" class="md-nav__link">
        🎚️ Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/debugging/" class="md-nav__link">
        🎯 Getting Started with PyOCD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/building_blocks/" class="md-nav__link">
        🧱 Interface Building Blocks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/error_handling/" class="md-nav__link">
        🪤 Error Handling
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          📝 Contributor Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          📝 Contributor Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../philosophy/" class="md-nav__link">
        📜 Design Philosophy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../organization/" class="md-nav__link">
        🗃️ Organization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../style/" class="md-nav__link">
        🎨 Style Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../library_guides/" class="md-nav__link">
        🔹 Library Development Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        🏗️ Architectural Design Decisions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          ℹ️ Project Information
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          ℹ️ Project Information
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../project_information/status/" class="md-nav__link">
        Library Status
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../project_information/about/" class="md-nav__link">
        About
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="bare-metal-arm-cortex-target-bring-up">🔸 Bare-Metal ARM Cortex Target Bring-Up</h1>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>TO BE MOVED TO <code>libhal-armcortex</code> REPO</p>
</div>
<p>This guide will step you through making a libhal + conan target library for a
arm processor microcontroller. Unlike libhal applications that can be executed
on a machine running an OS like linux, example Raspberry Pi and Beagle Boards,
you cannot just execute the binary.</p>
<p>This guide assumes that <code>libhal-library</code> was used as a template and has already
updated and changed all of the names from <code>libhal-library</code> to the appropriate
library name.</p>
<p>In order to build an application that can be loaded and executed onto a
microcontroller you only need:</p>
<ol>
<li>Add <code>libhal-armcortex</code> as a dependency</li>
<li>Provide a linker script for each microcontroller</li>
<li>Determine minimum compiler flags for each microcontroller</li>
<li>Provide a library component for that microcontroller</li>
</ol>
<p>The rest can be handled by the <code>arm-gnu-embedded-toolchain</code>'s <code>crt0</code>
implementation, the <code>arm-gnu-embedded-toolchain</code> conan package and the
<code>libhal-armcortex</code> conan package.</p>
<h2 id="adding-the-libhal-armcortex-dependency">Adding the <code>libhal-armcortex</code> dependency</h2>
<p>Simply add <code>libhal-armcortex</code> to your <code>requirements()</code> method:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">(</span><span class="s2">&quot;libhal-armcortex/[^1.0.1]&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="writing-the-linker-scripts">Writing the linker scripts</h2>
<h3 id="setup-linker-script-directory">Setup linker script directory</h3>
<p>Create a <code>linker_scripts</code> directory at the root of the library package.
Add <code>linker_scripts/*</code> directory to the export sources in the package
<code>conanfile.py</code>, like so:</p>
<div class="highlight"><pre><span></span><code><span class="n">exports_sources</span> <span class="o">=</span> <span class="s2">&quot;include/*&quot;</span><span class="p">,</span> <span class="s2">&quot;linker_scripts/*&quot;</span><span class="p">,</span> <span class="s2">&quot;tests/*&quot;</span><span class="p">,</span> <span class="s2">&quot;LICENSE&quot;</span>
</code></pre></div>
<h3 id="finding-linker-scripts-info">Finding linker scripts info</h3>
<p>Lets consider the <code>lpc4074</code> microcontroller. What you'll need to figure out is:</p>
<ol>
<li>Flash memory address &amp; size</li>
<li>Ram memory address &amp; size</li>
</ol>
<p>These sections are part of whats called the "memory map". Most modern day
systems use a system called "Memory-mapped I/O" which means that the system uses
the same address space to address both memory and I/O devices. In this case we
simply want to find the addresses of the flash memory and ram memory. This
information can be found in the data sheet or user manual of the chip.</p>
<p>The LPC40 series of microcontrollers will be used for this example:
The memory map can be found on page 52 of the <code>LPC408X_7X.pdf</code> data sheet or
page 14 of the <code>UM10562.pdf</code> user manual.</p>
<p><img alt="lpc40xx memory map" src="lpc40xx-memory-map.png" /></p>
<p style="text-align: center; font-style: italic;">
Figure 1. LPC40xx Memory Map
</p>

<p>Here you can see that flash starts at address <code>0x00000000</code> for all sizes of
flash memory. The SRAM locations all start at <code>0x10000000</code> for all sizes of
SRAM. This chart does not provide which chips have which ram and flash sizes.</p>
<p>Looking through the data sheet and searching for terms like "part numbers",
"ordering options", or even just the number 512 (the maximum flash size),
eventually this section will appear:</p>
<p><img alt="lpc40xx ordering info part 1" src="lpc40xx-ordering-1.png" /></p>
<p style="text-align: center; font-style: italic;">
Figure 2. LPC40xx Part Ordering Info part 1
</p>

<p><img alt="lpc40xx ordering info part 2" src="lpc40xx-ordering-2.png" /></p>
<p style="text-align: center; font-style: italic;">
Figure 3. LPC40xx Part Ordering Info part 2
</p>

<p>Now all of the information to write the linker scripts is available:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:5"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><input id="__tabbed_1_4" name="__tabbed_1" type="radio" /><input id="__tabbed_1_5" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">lpc4072.ld</label><label for="__tabbed_1_2">lpc4074.ld</label><label for="__tabbed_1_3">lpc4076.ld</label><label for="__tabbed_1_4">lpc4078.ld</label><label for="__tabbed_1_5">lpc4088.ld</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>__flash = 0x00000000;
__flash_size = 64K;
__ram = 0x10000000;
__ram_size = 16K;

INCLUDE &quot;libhal-armcortex/standard.ld&quot;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>__flash = 0x00000000;
__flash_size = 128K;
__ram = 0x10000000;
__ram_size = 32K;

INCLUDE &quot;libhal-armcortex/standard.ld&quot;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>__flash = 0x00000000;
__flash_size = 256K;
__ram = 0x10000000;
__ram_size = 64K;

INCLUDE &quot;libhal-armcortex/standard.ld&quot;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>__flash = 0x00000000;
__flash_size = 512K;
__ram = 0x10000000;
__ram_size = 64K;

INCLUDE &quot;libhal-armcortex/standard.ld&quot;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>__flash = 0x00000000;
__flash_size = 512K;
__ram = 0x10000000;
__ram_size = 64K;

INCLUDE &quot;libhal-armcortex/standard.ld&quot;
</code></pre></div>
</div>
</div>
</div>
<hr />
<div class="admonition question">
<p class="admonition-title">Question</p>
<p>You may be wondering why the RAM size is 64kB and not 96kB for some of the
linker scripts and thats due to the fact that the LPC40xx series has a dual
SRAM architecture. To keep this simple, only the largest RAM block is
supported.</p>
</div>
<p>The linker script only needs 4 lines as <code>libhal-armcortex</code> provides a standard
linker script for ARM microcontrollers supporting 1 flash memory and 1 ram
device. Defining the <code>__flash</code>, <code>__flash_size</code>, <code>__ram</code>, and <code>__ram_size</code>
linker script variables is all that is needed to make a usable linker script.</p>
<p>There are plans to support dual flash, dual ram and other varieties of flash
and ram combinations in the future in <code>libhal-armcortex</code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Many of the microcontrollers come in different packages and may have some
differences in the number of peripherals they support, pins they have and
performance. The linker script does not need to worry about such
differences and thus, a linker script should <strong>NOT</strong> be made for every
possible chip variety in the series but for the common flash sizes and ram
sizes for each.</p>
</div>
<h2 id="compiler-flags">Compiler flags</h2>
<h3 id="processor-flags">Processor flags</h3>
<p>The data sheet will include information about the processor. The compiler flag
will match the following based on the CPU:</p>
<ul>
<li><code>-mcpu=cortex-m0</code></li>
<li><code>-mcpu=cortex-m0plus</code> (cortex-M0+)</li>
<li><code>-mcpu=cortex-m1</code></li>
<li><code>-mcpu=cortex-m3</code></li>
<li><code>-mcpu=cortex-m4</code></li>
<li><code>-mcpu=cortex-m7</code></li>
<li><code>-mcpu=cortex-m23</code></li>
<li><code>-mcpu=cortex-m33</code></li>
<li><code>-mcpu=cortex-m35p</code></li>
<li><code>-mcpu=cortex-m55</code></li>
<li><code>-mcpu=cortex-m85</code></li>
<li><code>-mcpu=cortex-m1.small-multiply</code></li>
<li><code>-mcpu=cortex-m0.small-multiply</code></li>
<li><code>-mcpu=cortex-m0plus.small-multiply</code></li>
</ul>
<h3 id="floating-point-support">Floating Point Support</h3>
<p>After one of the following to the architecture flags:</p>
<ul>
<li><code>-mfloat-abi=soft</code>: if the processor is an cortex-m3 or below</li>
<li><code>-mfloat-abi=softfp</code>: if the processor is a cortex-m4 and above AND also has
  a floating point unit. This can be determined by searching the data sheet.</li>
</ul>
<h2 id="creating-components-for-the-library">Creating components for the library</h2>
<p>libhal target library's split up the library into components, one for each
microcontroller variant. For LPC40 that split would look like:
<code>libhal::lpc4072</code>, <code>libhal::lpc4074</code>, <code>libhal::lpc4076</code>, <code>libhal::lpc4078</code>, and
<code>libhal::lpc4088</code>. When a build system, for example, uses the <code>libhal::lpc4078</code>
component, it includes the necessary compiler flags and linker script selection.</p>
<p>Along with these components, will be a special generic component named
<code>libhal::lpc</code> which does not provide any compiler flags or linker script. This
special target is used for applications that want to use their own linker
script, or for software running on a host machine like simulations or unit
tests.</p>
<p>To add components it must be added in the <code>package_info</code> method of the
<code>ConanFile</code> package class. Here is what it looks like for the <code>libhal-lpc</code>
library. Copy this section and tailor it to your needs.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">package_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="c1"># Specify, for the component, all requirements of the package</span>
  <span class="n">requirements_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;libhal::libhal&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;libhal-util::libhal-util&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;libhal-armcortex::libhal-armcortex&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;ring-span-lite::ring-span-lite&quot;</span><span class="p">]</span>

  <span class="c1"># List of REQUIRED compiler flags for the gnu-arm-embedded-toolchain for some</span>
  <span class="c1"># of the chips. These are determined by the capabilities of the chip.</span>
  <span class="c1"># For example all but the lpc4072 and lpc4074 have hardware floating point</span>
  <span class="c1"># arithmetic support so they ought to use &quot;float-abi=softfp&quot; which uses the</span>
  <span class="c1"># floating point hardware BUT is ABI compatible with the software</span>
  <span class="c1"># implementation.</span>
  <span class="n">m4f_architecture_flags</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s2">&quot;-mcpu=cortex-m4&quot;</span><span class="p">,</span>
      <span class="s2">&quot;-mfloat-abi=softfp&quot;</span><span class="p">,</span>
  <span class="p">]</span>

  <span class="c1"># List of REQUIRED compiler flags for the gnu-arm-embedded-toolchain for</span>
  <span class="c1"># some of the chips. These are determined by the capabilities of the chip.</span>
  <span class="c1"># For example the lpc4072 and lpc4074 do not have hardware floating point</span>
  <span class="c1"># arithmetic support so they must use &quot;float-abi=soft&quot; for a software</span>
  <span class="c1"># implementation.</span>
  <span class="n">m4_architecture_flags</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s2">&quot;-mcpu=cortex-m4&quot;</span><span class="p">,</span>
      <span class="s2">&quot;-mfloat-abi=soft&quot;</span>
  <span class="p">]</span>

  <span class="c1"># Create a path to the linker_script directory which resides in the</span>
  <span class="c1"># package&#39;s package_folder.</span>
  <span class="n">linker_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_folder</span><span class="p">,</span> <span class="s2">&quot;linker_script&quot;</span><span class="p">)</span>

  <span class="c1"># Set the cmake file name</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;cmake_file_name&quot;</span><span class="p">,</span> <span class="s2">&quot;libhal-lpc&quot;</span><span class="p">)</span>
  <span class="c1"># All the package to be found in anyway with cmake</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;cmake_find_mode&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">)</span>

  <span class="c1"># Create the special/generic component &quot;lpc&quot; and set its component name</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;lpc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span>
      <span class="s2">&quot;cmake_target_name&quot;</span><span class="p">,</span>  <span class="s2">&quot;libhal::lpc&quot;</span><span class="p">)</span>

  <span class="c1"># This is where we add the path to our linker scripts to the set of linker</span>
  <span class="c1"># flags.</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;lpc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">exelinkflags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;-L&quot;</span> <span class="o">+</span> <span class="n">linker_path</span><span class="p">)</span>

  <span class="c1"># Add the list of requirements to the generic component</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;lpc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">requires</span> <span class="o">=</span> <span class="n">requirements_list</span>

  <span class="c1"># Helper function for creating components</span>
  <span class="k">def</span> <span class="nf">create_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component</span><span class="p">,</span> <span class="n">flags</span><span class="p">):</span>

      <span class="n">link_script</span> <span class="o">=</span> <span class="s2">&quot;-Tlibhal-lpc/&quot;</span> <span class="o">+</span> <span class="n">component</span> <span class="o">+</span> <span class="s2">&quot;.ld&quot;</span>
      <span class="n">component_name</span> <span class="o">=</span> <span class="s2">&quot;libhal::&quot;</span> <span class="o">+</span> <span class="n">component</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span>
          <span class="s2">&quot;cmake_target_name&quot;</span><span class="p">,</span> <span class="n">component_name</span><span class="p">)</span>
      <span class="c1"># Make the special component the only requirement for the component,</span>
      <span class="c1"># inheriting all of the transitive dependencies.</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">requires</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lpc&quot;</span><span class="p">]</span>
      <span class="c1"># Add the link script and flags to the component&#39;s linker flags and</span>
      <span class="c1"># compiler flags</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">exelinkflags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link_script</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">exelinkflags</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
      <span class="c1"># Add flags to the cflags &amp; cxxflags to ensure that each compilation unit</span>
      <span class="c1"># Knows the instruction set and float ABI</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">cflags</span> <span class="o">=</span> <span class="n">flags</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">cxxflags</span> <span class="o">=</span> <span class="n">flags</span>

  <span class="c1"># Create the components for each chip.</span>
  <span class="n">create_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;lpc4072&quot;</span><span class="p">,</span> <span class="n">m4_architecture_flags</span><span class="p">)</span>
  <span class="n">create_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;lpc4074&quot;</span><span class="p">,</span> <span class="n">m4_architecture_flags</span><span class="p">)</span>
  <span class="n">create_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;lpc4076&quot;</span><span class="p">,</span> <span class="n">m4f_architecture_flags</span><span class="p">)</span>
  <span class="n">create_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;lpc4078&quot;</span><span class="p">,</span> <span class="n">m4f_architecture_flags</span><span class="p">)</span>
  <span class="n">create_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;lpc4088&quot;</span><span class="p">,</span> <span class="n">m4f_architecture_flags</span><span class="p">)</span>
</code></pre></div>
<h2 id="verifying">Verifying</h2>
<h3 id="creating-the-package">Creating the package</h3>
<p>Run <code>conan create .</code> in the folder with the <code>conanfile.py</code> recipe in it.
The test package and build stages should show something like this during the
cmake phase:</p>
<div class="highlight"><pre><span></span><code>-- Conan: Component target declared &#39;libhal::lpc&#39;
-- Conan: Component target declared &#39;libhal::lpc4072&#39;
-- Conan: Component target declared &#39;libhal::lpc4074&#39;
-- Conan: Component target declared &#39;libhal::lpc4076&#39;
-- Conan: Component target declared &#39;libhal::lpc4078&#39;
-- Conan: Component target declared &#39;libhal::lpc4088&#39;
</code></pre></div>
<h3 id="testing-out-a-demo">Testing out a demo</h3>
<p>Create a demo and have it require the library. In this case the demo
<code>conafile.py</code> may include:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">conan</span> <span class="kn">import</span> <span class="n">ConanFile</span>
<span class="kn">from</span> <span class="nn">conan.tools.cmake</span> <span class="kn">import</span> <span class="n">CMake</span><span class="p">,</span> <span class="n">cmake_layout</span>


<span class="k">class</span> <span class="nc">Lpc40xxDemos</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="s2">&quot;compiler&quot;</span><span class="p">,</span> <span class="s2">&quot;build_type&quot;</span>
    <span class="n">generators</span> <span class="o">=</span> <span class="s2">&quot;CMakeToolchain&quot;</span><span class="p">,</span> <span class="s2">&quot;CMakeDeps&quot;</span><span class="p">,</span> <span class="s2">&quot;VirtualBuildEnv&quot;</span>

    <span class="k">def</span> <span class="nf">requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">(</span><span class="s2">&quot;libhal-lpc/1.1.4&quot;</span><span class="p">)</span> <span class="c1"># &lt;-- change this</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">(</span><span class="s2">&quot;libhal-util/[^1.0.0]&quot;</span><span class="p">)</span> <span class="c1"># &lt;-- update this if necessary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tool_requires</span><span class="p">(</span><span class="s2">&quot;gnu-arm-embedded-toolchain/11.3.0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tool_requires</span><span class="p">(</span><span class="s2">&quot;cmake-arm-embedded/0.1.1&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmake_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmake</span> <span class="o">=</span> <span class="n">CMake</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">cmake</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
        <span class="n">cmake</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</code></pre></div>
<p>Change the library name to the library you are creating.</p>
<div class="highlight"><pre><span></span><code><span class="bp">self</span><span class="o">.</span><span class="n">tool_requires</span><span class="p">(</span><span class="s2">&quot;gnu-arm-embedded-toolchain/11.3.0&quot;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">tool_requires</span><span class="p">(</span><span class="s2">&quot;cmake-arm-embedded/0.1.1&quot;</span><span class="p">)</span>
</code></pre></div>
<p>The above two requirements are required to download and install the
toolchain/compiler and the cmake toolchain/helper files. The project should
compile if everything was done correctly.</p>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.tabs.link", "toc.integrate", "navigation.tracking", "navigation.footer"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>